// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model RFP {
  id                    String   @id @default(uuid())
  title                 String
  description           String?  @db.Text
  items                 Json     // Array of {name, quantity, specifications}
  budget                Decimal? @db.Decimal(12, 2)
  deliveryDeadline      DateTime? @map("delivery_deadline")
  paymentTerms          String?  @map("payment_terms") @db.VarChar(100)
  warrantyRequirements  String?  @map("warranty_requirements") @db.VarChar(255)
  otherRequirements     String?  @map("other_requirements") @db.Text
  status                RFPStatus @default(DRAFT)
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  // Relations
  proposals             Proposal[]
  rfpVendors            RFPVendor[]

  @@map("rfps")
}

model Vendor {
  id              String   @id @default(uuid())
  name            String
  email           String   @unique
  contactPerson   String?  @map("contact_person")
  phone           String?  @db.VarChar(50)
  address         String?  @db.Text
  category        String?  @db.VarChar(100)
  notes           String?  @db.Text
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  proposals       Proposal[]
  rfpVendors      RFPVendor[]

  @@map("vendors")
}

model Proposal {
  id                String   @id @default(uuid())
  rfpId             String   @map("rfp_id")
  vendorId          String   @map("vendor_id")
  itemsPricing      Json?    @map("items_pricing") // Array of {item, unitPrice, quantity, total}
  totalPrice        Decimal? @map("total_price") @db.Decimal(12, 2)
  deliveryTime      String?  @map("delivery_time") @db.VarChar(100)
  paymentTerms      String?  @map("payment_terms") @db.VarChar(100)
  warranty          String?  @db.VarChar(255)
  additionalNotes   String?  @map("additional_notes") @db.Text
  rawEmailContent   String?  @map("raw_email_content") @db.Text
  parsedAt          DateTime? @map("parsed_at")
  status            ProposalStatus @default(RECEIVED)
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  // Relations
  rfp               RFP      @relation(fields: [rfpId], references: [id], onDelete: Cascade)
  vendor            Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([rfpId, vendorId])
  @@map("proposals")
}

model RFPVendor {
  id            String   @id @default(uuid())
  rfpId         String   @map("rfp_id")
  vendorId      String   @map("vendor_id")
  sentAt        DateTime? @map("sent_at")
  emailStatus   EmailStatus @default(PENDING) @map("email_status")
  createdAt     DateTime @default(now()) @map("created_at")

  // Relations
  rfp           RFP      @relation(fields: [rfpId], references: [id], onDelete: Cascade)
  vendor        Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([rfpId, vendorId])
  @@map("rfp_vendors")
}

enum RFPStatus {
  DRAFT
  SENT
  CLOSED
}

enum ProposalStatus {
  RECEIVED
  PARSED
  REVIEWED
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
}
